<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babylon Project</title>

    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>

</head>
<style>
    .canvas {
        height: 100%;
        width: 100%;
    }
</style>

<body>

    <div class="Frame">
        <canvas id="renderCanvas" class="canvas"></canvas>
    </div>
    <div>
        <button id="move" onclick="changecam('1')">Click to move</button>
        <button id="dont" onclick="changecam('0')">dont move</button>
    </div>
    <script>
        let sceneToRender;
        const cam = document.getElementById("move").value;
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);


        const createScene = async () => {
            const scene = new BABYLON.Scene(engine);
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));


            const box = BABYLON.MeshBuilder.CreateBox("box", {});
            box.position.x = 2;
            box.position.y = 1;

            const fish = BABYLON.SceneLoader.ImportMesh(
                "",
                "./assets/",
                "fish.glb",
                scene,
                function (newMeshes) {
                    newMeshes[0].scaling = new BABYLON.Vector3(1, 1, 1);
                }
            );
            //    const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2,  1, -2, new BABYLON.Vector3(0, 0, 0));
            const camera1 = new BABYLON.FreeCamera(
                "freeCamera",
                new BABYLON.Vector3(0, 0, -10),
                scene
            );

            camera1.attachControl(canvas, true);
            camera1.lowerRadiusLimit = 8
            camera1.upperRadiusLimit = 15





            const videoLayer = new BABYLON.Layer('videoLayer', null, scene, true);
            const videoTexture = BABYLON
                .VideoTexture
                .CreateFromWebCam(
                    scene, (videoTexture) => {
                        videoTexture._invertY = false;
                        videoTexture
                        videoLayer.texture = videoTexture;
                    }, { maxWidth: canvas.width, maxHeight: canvas.height, facingMode: "environment" });

                    
            const xrHelper = await scene.createDefaultXRExperienceAsync({
                uiOptions: {
                    sessionMode: "immersive-ar",
                    referenceSpaceType: "local-floor"
                },
                optionalFeatures: true
            });
            if (!xrHelper.baseExperience) {
                // XR support is unavailable.
                console.log("WebXR support is unavailable");
            } else {
            //    // XR support is available; proceed.
            //     const supported = await WebXRSessionManager.IsSessionSupportedAsync('immersive-vr');
            //     if (supported) {
            //     // xr available, session supported
            //     const sessionManager = new WebXRSessionManager(scene);
            //     const xrCamera = new WebXRCamera("freeCamera", scene, sessionManager);
                }

                return scene;
          
        };





        scene = createScene();
        console.log(scene);
        scene.then(function (returnedScene) {
            sceneToRender = returnedScene;
        });

        // Run render loop to render future frames.
        engine.runRenderLoop(function () {
            if (sceneToRender) {
                sceneToRender.render();
            }
        });

        // Handle browser resize.
        window.addEventListener("resize", function () {
            engine.resize();
        });

    </script>
</body>

</html>